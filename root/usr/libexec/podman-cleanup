#!/bin/sh
# Cleanup orphaned Podman sessions with no activity for 2+ minutes
# Handles: log streams (podman_logs_*) and image pulls (podman_pull_*)
# Called by cron every minute

for f in /tmp/podman_logs_*.pid /tmp/podman_pull_*.pid; do
	[ -f "$f" ] || continue
	s="${f%.pid}"
	# Skip if activity file exists and is recent (< 2 minutes old)
	[ -f "$s.activity" ] && [ "$(find "$s.activity" -mmin -2 2>/dev/null)" ] && continue
	# Kill orphaned process and cleanup files
	kill "$(cat "$f")" 2>/dev/null
	rm -f "$s."* 2>/dev/null
done
